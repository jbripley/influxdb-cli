#!/usr/bin/env ruby

require 'rubygems'
require 'influxdb'
require 'pry'
require 'thor'
require 'awesome_print'

Dir['../lib/**/*.rb'].each &method(:require)

class InfluxDBClientTasks < Thor
  desc 'db', 'Connect to InfluxDB'
  method_option :host,      :default => 'localhost',  :aliases => '-h',  :desc => 'Hostname'
  method_option :port,      :default => 8086,         :desc => 'Port'
  method_option :username,  :default => 'root',       :aliases => '-u',  :desc => 'Username'
  method_option :password,  :default => 'root',       :aliases => '-p',  :desc => 'Password'
  method_option :database,  :default => 'db',         :aliases => '-d',  :desc => 'Database'
  def db
    puts "Connecting to #{options.inspect}"
    @@db ||= InfluxDB::Client.new options[:database],
      { username: options[:username], password: options[:password], host: options[:host], port: options[:port] }
    puts 'âœ” ready'
  end

  def self.db; @@db; end

  default_task :db
end

def db; InfluxDBClientTasks.db; end

InfluxDBClientTasks.start

Pry.config.print = proc { |output, value| Pry::Helpers::BaseHelpers.stagger_output("=> #{value.ai}", output) }

pry

